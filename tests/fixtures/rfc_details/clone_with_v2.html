<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>PHP: rfc:clone_with_v2</title>

  <meta name="generator" content="DokuWiki"/>
<meta name="robots" content="index,follow"/>
<meta name="keywords" content="rfc,clone_with_v2"/>
<link rel="search" type="application/opensearchdescription+xml" href="/lib/exe/opensearch.php" title="PHP Wiki"/>
<link rel="start" href="/"/>
<link rel="contents" href="/rfc/clone_with_v2?do=index" title="Sitemap"/>
<link rel="manifest" href="/lib/exe/manifest.php"/>
<link rel="alternate" type="application/rss+xml" title="Recent Changes" href="/feed.php"/>
<link rel="alternate" type="application/rss+xml" title="Current namespace" href="/feed.php?mode=list&amp;ns=rfc"/>
<link rel="alternate" type="text/html" title="Plain HTML" href="/_export/xhtml/rfc/clone_with_v2"/>
<link rel="alternate" type="text/plain" title="Wiki Markup" href="/_export/raw/rfc/clone_with_v2"/>
<link rel="canonical" href="https://wiki.php.net/rfc/clone_with_v2"/>
<link rel="stylesheet" href="/lib/exe/css.php?t=phpnet&amp;tseed=7bd2b78bb5550d8ceb3c825c96dd22d0"/>
<!--[if gte IE 9]><!-->
<script >/*<![CDATA[*/var NS='rfc';var JSINFO = {"id":"rfc:clone_with_v2","namespace":"rfc","ACT":"show","useHeadingNavigation":0,"useHeadingContent":0};
/*!]]>*/</script>
<script src="/lib/exe/jquery.php?tseed=f0349b609f9b91a485af8fd8ecd4aea4" defer="defer">/*<![CDATA[*/
/*!]]>*/</script>
<script src="/lib/exe/js.php?t=phpnet&amp;tseed=7bd2b78bb5550d8ceb3c825c96dd22d0" defer="defer">/*<![CDATA[*/
/*!]]>*/</script>
<!--<![endif]-->
  <link media='all' rel='stylesheet' href='//shared.php.net/styles/defaults.css?filemtime=1732659606'/>
  <link media='all' rel='stylesheet' href='//shared.php.net/styles/wiki.css?filemtime=1707322306'/>

  <link href="//fonts.googleapis.com/css?family=Fira+Sans|Source+Sans+Pro:300,400,600,400italic,600italic|Source+Code+Pro&amp;subset=latin,latin-ext" rel="stylesheet">
  <link rel="shortcut icon" href="//php.net/favicon.ico">
<!--[if lt IE 9]>
  <script src="//shared.php.net/js/html5shiv.js"></script>
<![endif]-->
  </head>
<body id="">

<div class="wrap">
<header class='clearfix'>
  <div id="mainmenu-toggle-overlay"></div>
  <input type="checkbox" id="mainmenu-toggle">
  <nav class="fullscreen">
    <div class="mainscreen">
      <a href="/" class="home"><img src="//php.net/images/logo.php?" width="48" height="24" alt="php"><span class="subdomain"></span></a>
      <ul>
        <li class=""><a href="?do=login">Login</a></li>
        <li class=""><a href="?do=register">Register</a></li>
      </ul>
    </div>
    <div class="secondscreen">
      <form method="get" action="/start">
        <input type="search" placeholder="Search" name="id" class="search">
        <input type="hidden" name="do" value="search">
      </form>
    </div>
  </nav>
</header>
<div id="flash-message"></div>
<nav id="megadropdown"></nav>

<section class="fullscreen clearfix">


<section id="breadcrumbs">
<nav>
<span class="bchead">You are here: </span><span class="home"><bdi><a href="/start" class="wikilink1" title="start" data-wiki-id="start">start</a></bdi></span> › <bdi><a href="/rfc" class="wikilink1" title="rfc" data-wiki-id="rfc">rfc</a></bdi> › <bdi><a href="/rfc/clone_with_v2" class="wikilink1" title="rfc:clone_with_v2" data-wiki-id="rfc:clone_with_v2">clone_with_v2</a></bdi></nav>
</section>
<section class="mainscreen">
    <!--[if lte IE 7 ]><div id="IE7"><![endif]--><!--[if IE 8 ]><div id="IE8"><![endif]-->
    <div id="dokuwiki__site"><div id="dokuwiki__top" class="site dokuwiki mode_show tpl_phpnet     ">


        <div class="wrapper group">

            
            <!-- ********** CONTENT ********** -->
            <div id="dokuwiki__content"><div class="pad group">

                <div class="pageId"><span>rfc:clone_with_v2</span></div>

                <div class="page group">
                                                            <!-- wikipage start -->
                                        
<h1 class="sectionedit1" id="php_rfcclone_with_v2">PHP RFC: Clone with v2</h1>
<div class="level1">
<ul>
<li class="level1"><div class="li"> Version: 1.1</div>
</li>
<li class="level1"><div class="li"> Date: 2025-03-30</div>
</li>
<li class="level1"><div class="li"> Author: Volker Dusch (volker@tideways-gmbh.com), Tim Düsterhus (tim@tideways-gmbh.com)</div>
</li>
<li class="level1"><div class="li"> Status: Voting</div>
</li>
<li class="level1"><div class="li"> First Published at: <a href="https://wiki.php.net/rfc/clone_with_v2" class="urlextern" title="https://wiki.php.net/rfc/clone_with_v2" rel="ugc nofollow">https://wiki.php.net/rfc/clone_with_v2</a></div>
</li>
</ul>

</div>

<h2 class="sectionedit2" id="introduction">Introduction</h2>
<div class="level2">

<p>
Both <code class="code php">readonly</code> properties and the cloning of objects are commonplace in a lot of PHP applications, but these two concepts don’t fully work together in all cases. 
</p>

<p>
This <abbr title="Request for Comments">RFC</abbr> proposes to address this issue by allowing the <code class="code php">clone</code> language construct to work well with <code class="code php">readonly</code> properties.
</p>

<p>
One common usage pattern for object cloning is “immutable value-objects” having <code class="code php"><span class="sy0">-&gt;</span><span class="me1">withProperty</span><span class="br0">&#40;</span><span class="br0">&#41;</span></code> methods returning a new object with some property changed. This doesn’t work smoothly with <code class="code php">readonly</code> properties at the moment.
</p>
<div class="phpok">
<pre class="code php"><span class="kw2">&lt;?php</span>
&nbsp;
final readonly <span class="kw2">class</span> Response <span class="br0">&#123;</span>
    <span class="kw2">public</span> <span class="kw2">function</span> __construct<span class="br0">&#40;</span>
        <span class="kw2">public</span> int <span class="re0">$statusCode</span><span class="sy0">,</span>
        <span class="kw2">public</span> string <span class="re0">$reasonPhrase</span><span class="sy0">,</span>
        <span class="co1">// ...</span>
    <span class="br0">&#41;</span> <span class="br0">&#123;</span><span class="br0">&#125;</span>
&nbsp;
    <span class="kw2">public</span> <span class="kw2">function</span> withStatus<span class="br0">&#40;</span><span class="re0">$code</span><span class="sy0">,</span> <span class="re0">$reasonPhrase</span> <span class="sy0">=</span> <span class="st_h">''</span><span class="br0">&#41;</span><span class="sy0">:</span> Response
    <span class="br0">&#123;</span>
        <span class="co1">// Only works if all properties are assignable via __construct</span>
        <span class="re0">$values</span> <span class="sy0">=</span> <a href="http://www.php.net/get_object_vars"><span class="kw3">get_object_vars</span></a><span class="br0">&#40;</span><span class="re0">$this</span><span class="br0">&#41;</span><span class="sy0">;</span>
        <span class="re0">$values</span><span class="br0">&#91;</span><span class="st_h">'statusCode'</span><span class="br0">&#93;</span> <span class="sy0">=</span> <span class="re0">$code</span><span class="sy0">;</span>
        <span class="re0">$values</span><span class="br0">&#91;</span><span class="st_h">'reasonPhrase'</span><span class="br0">&#93;</span> <span class="sy0">=</span> <span class="re0">$reasonPhrase</span><span class="sy0">;</span>
        <span class="kw1">return</span> <span class="kw2">new</span> <span class="kw2">self</span><span class="br0">&#40;</span>
            <span class="sy0">...</span><span class="re0">$values</span>
        <span class="br0">&#41;</span><span class="sy0">;</span>
    <span class="br0">&#125;</span>
<span class="br0">&#125;</span></pre></div>

<p>
To address this, we propose what we consider a simple change that makes <code class="code php">clone</code> look and mostly behave like a regular function call. This will align <code class="code php">clone</code> with current PHP users&#039; expectations regarding syntax and semantics, while still respecting property visibility rules.
</p>
<div class="phpok">
<pre class="code php">    <span class="kw2">public</span> <span class="kw2">function</span> withStatus<span class="br0">&#40;</span><span class="re0">$code</span><span class="sy0">,</span> <span class="re0">$reasonPhrase</span> <span class="sy0">=</span> <span class="st_h">''</span><span class="br0">&#41;</span><span class="sy0">:</span> Response <span class="br0">&#123;</span>
        <span class="kw1">return</span> clone<span class="br0">&#40;</span><span class="re0">$this</span><span class="sy0">,</span> <span class="br0">&#91;</span>
            <span class="st0">&quot;statusCode&quot;</span> <span class="sy0">=&gt;</span> <span class="re0">$code</span><span class="sy0">,</span>
            <span class="st0">&quot;reasonPhrase&quot;</span> <span class="sy0">=&gt;</span> <span class="re0">$reasonPhrase</span><span class="sy0">,</span>
        <span class="br0">&#93;</span><span class="br0">&#41;</span><span class="sy0">;</span>
    <span class="br0">&#125;</span></pre></div>

<p>
The main reason we think a <code class="code php">clone<span class="br0">&#40;</span><span class="br0">&#41;</span></code> function that directly updates the properties is preferable to one that passes the updated properties to the magic <code class="code php">__clone<span class="br0">&#40;</span><span class="br0">&#41;</span></code> method of an object, is that it allows objects with public properties to be cloned with changed properties from the outside without assistance by the object. Furthermore, within a class changes can be localized in appropriate methods rather than centralized in the <code class="code php">__clone<span class="br0">&#40;</span><span class="br0">&#41;</span></code> method.
</p>

</div>

<h2 class="sectionedit3" id="prior_works">Prior Works</h2>
<div class="level2">

<p>
This change was proposed in <a href="https://wiki.php.net/rfc/clone_with" class="urlextern" title="https://wiki.php.net/rfc/clone_with" rel="ugc nofollow">https://wiki.php.net/rfc/clone_with</a> and discussed <a href="https://externals.io/message/120048" class="urlextern" title="https://externals.io/message/120048" rel="ugc nofollow">https://externals.io/message/120048</a>
</p>

<p>
Máté, the original <abbr title="Request for Comments">RFC</abbr> author, dropped the <abbr title="Request for Comments">RFC</abbr> and had no objections to us proposing this continuation trying to address the same need.
</p>

</div>

<h2 class="sectionedit4" id="proposal">Proposal</h2>
<div class="level2">

<p>
We propose to change <code class="code php">clone</code> from a standalone keyword to a language construct that optionally accepts a second <code class="code php"><a href="http://www.php.net/array"><span class="kw3">array</span></a></code> parameter.
</p>
<div class="phpok">
<pre class="code php"><span class="kw2">function</span> clone<span class="br0">&#40;</span>object <span class="re0">$object</span><span class="sy0">,</span> <a href="http://www.php.net/array"><span class="kw3">array</span></a> <span class="re0">$withProperties</span> <span class="sy0">=</span> <span class="br0">&#91;</span><span class="br0">&#93;</span><span class="br0">&#41;</span><span class="sy0">:</span> object <span class="br0">&#123;</span><span class="br0">&#125;</span></pre></div>

<p>
This allows all the following syntax examples to be valid:
</p>
<div class="phpok">
<pre class="code php"><span class="re0">$y</span> <span class="sy0">=</span> clone <span class="re0">$x</span><span class="sy0">;</span>
<span class="re0">$y</span> <span class="sy0">=</span> clone<span class="br0">&#40;</span><span class="re0">$x</span><span class="br0">&#41;</span><span class="sy0">;</span>
<span class="re0">$y</span> <span class="sy0">=</span> \clone<span class="br0">&#40;</span><span class="re0">$x</span><span class="br0">&#41;</span><span class="sy0">;</span>
<span class="re0">$y</span> <span class="sy0">=</span> clone<span class="br0">&#40;</span><span class="re0">$x</span><span class="sy0">,</span> <span class="br0">&#91;</span><span class="br0">&#93;</span><span class="br0">&#41;</span><span class="sy0">;</span>
<span class="re0">$y</span> <span class="sy0">=</span> clone<span class="br0">&#40;</span><span class="re0">$x</span><span class="sy0">,</span> <span class="br0">&#91;</span>
    <span class="st0">&quot;foo&quot;</span> <span class="sy0">=&gt;</span> <span class="re0">$foo</span><span class="sy0">,</span>
    <span class="st0">&quot;bar&quot;</span> <span class="sy0">=&gt;</span> <span class="re0">$bar</span><span class="sy0">,</span>
<span class="br0">&#93;</span><span class="br0">&#41;</span><span class="sy0">;</span>
<span class="re0">$y</span> <span class="sy0">=</span> clone<span class="br0">&#40;</span><span class="re0">$x</span><span class="sy0">,</span> <span class="re0">$array</span><span class="br0">&#41;</span><span class="sy0">;</span></pre></div>

<p>
By promoting <code class="code php">clone</code> to a function, it will also be possible to use it as a callable. E.g., in <code class="code php"><a href="http://www.php.net/array_map"><span class="kw3">array_map</span></a></code>. Promoting <code class="code php">clone</code> to a function also simplifies the implementation considerably.
</p>

</div>

<h3 class="sectionedit5" id="technical_details">Technical Details</h3>
<div class="level3">
<ul>
<li class="level1 node"><div class="li"> A magic <code class="code php">__clone<span class="br0">&#40;</span><span class="br0">&#41;</span></code> method will be called before the new properties are assigned.</div>
<ul>
<li class="level2"><div class="li"> Calling <code class="code php">__clone<span class="br0">&#40;</span><span class="br0">&#41;</span></code> afterward would mean the new properties would already be set and the old ones gone, contrasting existing behavior and thus users&#039; expectations.</div>
</li>
</ul>
</li>
<li class="level1"><div class="li"> Assignment of new properties happens in iteration order of the array parameter. As a result, should there be an error during the assignment (e.g., because of property hooks), the error will be raised for the first impacted property.</div>
</li>
<li class="level1 node"><div class="li"> Property assignments are made just as a regular assignment would be. Meaning all regular PHP rules apply with only the <code class="code php">readonly</code> state being “unlocked”.</div>
<ul>
<li class="level2"><div class="li"> Visibility rules for property access are enforced. Clone can&#039;t be used to modify the internal state of objects from outside.</div>
</li>
<li class="level2"><div class="li"> Property hooks work as expected. Setters are called during <code class="code php">clone</code> calls.</div>
</li>
<li class="level2"><div class="li"> Dynamic properties respect <code class="code php"><span class="co2">#[AllowDynamicProperties]</span></code>.</div>
</li>
<li class="level2"><div class="li"> <code class="code php">__set</code> works as expected and is called during clone as it would be during normal assignments.</div>
</li>
<li class="level2"><div class="li"> The behavior of Lazy Objects is not affected; as before, they will be de-lazyfied and cloned. </div>
</li>
</ul>
</li>
</ul>

<p>
A userland implementation of this would be replacing the <code class="code php">clone</code> call with the following code:
</p>
<div class="phpok">
<pre class="code php"><span class="kw2">&lt;?php</span>
&nbsp;
<span class="re0">$cloned</span> <span class="sy0">=</span> clone <span class="re0">$object</span><span class="sy0">;</span>
<span class="kw1">foreach</span> <span class="br0">&#40;</span><span class="re0">$withProperties</span> <span class="kw1">as</span> <span class="re0">$key</span> <span class="sy0">=&gt;</span> <span class="re0">$value</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
    <span class="re0">$cloned</span><span class="sy0">-&gt;</span><span class="br0">&#123;</span><span class="re0">$key</span><span class="br0">&#125;</span> <span class="sy0">=</span> <span class="re0">$value</span><span class="sy0">;</span>
<span class="br0">&#125;</span>
<span class="kw1">return</span> <span class="re0">$cloned</span><span class="sy0">;</span></pre></div>

<p>
The <code class="code php">clone</code> keyword (and T_CLONE token) will be kept and it will remain impossible to create a <code class="code php">clone</code> function within a namespace. It will also not be possible to disable the <code class="code php">clone<span class="br0">&#40;</span><span class="br0">&#41;</span></code> function with the <code>disable_functions=clone</code> INI setting.
</p>

</div>

<h3 class="sectionedit6" id="design_goals">Design Goals</h3>
<div class="level3">

<p>
When re-proposing this <abbr title="Request for Comments">RFC</abbr>, one of our goals was to take all previous discussion into account and propose something that is small in scope and cognitive load.
</p>

<p>
This <abbr title="Request for Comments">RFC</abbr> explicitly rejects any BC impacting syntax choices like the previously proposed <code class="code php">with</code> keyword, as we don&#039;t feel the scope of the feature warrants any BC impact.
</p>

<p>
Likewise, all syntax has to exist in PHP already, to not add cognitive load to readers when they come across it. A simple PHP array feels like the most ubiquitous syntax in PHP.
</p>

<p>
Furthermore, this <abbr title="Request for Comments">RFC</abbr> considers touching how <code class="code php">__clone</code> works (e.g. by adding parameters to it) to be a non-goal due to the increased complexity and <a href="#backward_incompatible_changes" title="rfc:clone_with_v2 ↵" class="wikilink1">BC considerations</a>.
</p>

</div>

<h3 class="sectionedit7" id="examples">Examples</h3>
<div class="level3">

</div>

<h4 id="using_clone_as_a_callable">Using clone as a callable</h4>
<div class="level4">
<div class="phpok">
<pre class="code php"><span class="kw2">&lt;?php</span>
&nbsp;
<span class="re0">$x</span> <span class="sy0">=</span> <span class="br0">&#91;</span><span class="kw2">new</span> stdClass<span class="sy0">,</span> <span class="kw2">new</span> stdClass<span class="br0">&#93;</span><span class="sy0">;</span>
&nbsp;
<a href="http://www.php.net/var_dump"><span class="kw3">var_dump</span></a><span class="br0">&#40;</span><a href="http://www.php.net/array_map"><span class="kw3">array_map</span></a><span class="br0">&#40;</span>clone<span class="br0">&#40;</span><span class="sy0">...</span><span class="br0">&#41;</span><span class="sy0">,</span> <span class="re0">$x</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span>
<a href="http://www.php.net/array_map"><span class="kw3">array_map</span></a><span class="br0">&#40;</span><span class="st_h">'clone'</span><span class="sy0">,</span> <span class="re0">$x</span><span class="br0">&#41;</span><span class="sy0">;</span> <span class="co1">// Works as well</span>
&nbsp;
<span class="co1">// array(2) {</span>
<span class="co1">//  [0] =&gt; object(stdClass)#4 (0) {}</span>
<span class="co1">//  [1] =&gt; object(stdClass)#5 (0) {}</span>
<span class="co1">// }</span></pre></div>

</div>

<h4 id="cloning_with_new_properties">Cloning with new properties</h4>
<div class="level4">
<div class="phpok">
<pre class="code php"><span class="kw2">&lt;?php</span>
&nbsp;
<span class="kw2">class</span> Foo <span class="br0">&#123;</span>
&nbsp;
    <span class="kw2">public</span> <span class="kw2">function</span> __construct<span class="br0">&#40;</span>
        <span class="kw2">private</span> readonly int <span class="re0">$c</span> <span class="sy0">=</span> <span class="nu0">1</span><span class="sy0">,</span>
    <span class="br0">&#41;</span> <span class="br0">&#123;</span><span class="br0">&#125;</span>
&nbsp;
    <span class="kw2">public</span> <span class="kw2">function</span> just_clone<span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
        <span class="kw1">return</span> clone <span class="re0">$this</span><span class="sy0">;</span>
    <span class="br0">&#125;</span>
&nbsp;
    <span class="kw2">public</span> <span class="kw2">function</span> clone_with<span class="br0">&#40;</span><span class="re0">$newC</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
        <span class="kw1">return</span> clone<span class="br0">&#40;</span><span class="re0">$this</span><span class="sy0">,</span> <span class="br0">&#91;</span><span class="st0">&quot;c&quot;</span> <span class="sy0">=&gt;</span> <span class="re0">$newC</span><span class="br0">&#93;</span><span class="br0">&#41;</span><span class="sy0">;</span>
    <span class="br0">&#125;</span>
<span class="br0">&#125;</span>
&nbsp;
<span class="re0">$x</span> <span class="sy0">=</span> <span class="kw2">new</span> Foo<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
<span class="co1">// object(Foo)#2 (1) { [&quot;c&quot;:&quot;Foo&quot;:private]=&gt; int(1) }</span>
<a href="http://www.php.net/var_dump"><span class="kw3">var_dump</span></a><span class="br0">&#40;</span><span class="re0">$x</span><span class="sy0">-&gt;</span><span class="me1">just_clone</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
<span class="co1">// object(Foo)#2 (1) { [&quot;c&quot;:&quot;Foo&quot;:private]=&gt; int(5) }</span>
<a href="http://www.php.net/var_dump"><span class="kw3">var_dump</span></a><span class="br0">&#40;</span><span class="re0">$x</span><span class="sy0">-&gt;</span><span class="me1">clone_with</span><span class="br0">&#40;</span><span class="nu0">5</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span></pre></div>

</div>

<h4 id="visibility_rules">Visibility rules</h4>
<div class="level4">

<p>
Public properties can be changed from the outside during cloning.
</p>
<div class="phpok">
<pre class="code php"><span class="kw2">&lt;?php</span>
&nbsp;
<span class="kw2">class</span> Foo <span class="br0">&#123;</span>
    <span class="kw2">public</span> int <span class="re0">$pub</span> <span class="sy0">=</span> <span class="nu0">1</span><span class="sy0">;</span>
<span class="br0">&#125;</span>
&nbsp;
<span class="re0">$foo</span> <span class="sy0">=</span> <span class="kw2">new</span> Foo<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
<span class="co1">// object(Foo)#2 (1) { [&quot;pub&quot;]=&gt; int(5) }</span>
<a href="http://www.php.net/var_dump"><span class="kw3">var_dump</span></a><span class="br0">&#40;</span>clone<span class="br0">&#40;</span><span class="re0">$foo</span><span class="sy0">,</span> <span class="br0">&#91;</span><span class="st0">&quot;pub&quot;</span> <span class="sy0">=&gt;</span> <span class="nu0">5</span><span class="br0">&#93;</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span></pre></div>

<p>
Public <code class="code php">readonly</code> properties can be changed during cloning from within the class.
</p>
<div class="phpok">
<pre class="code php"><span class="kw2">&lt;?php</span>
&nbsp;
<span class="kw2">class</span> Foo <span class="br0">&#123;</span>
    <span class="kw2">public</span> readonly int <span class="re0">$pub</span><span class="sy0">;</span>
&nbsp;
    <span class="kw2">public</span> <span class="kw2">function</span> withPub<span class="br0">&#40;</span><span class="re0">$newPub</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
        <span class="kw1">return</span> clone<span class="br0">&#40;</span><span class="re0">$this</span><span class="sy0">,</span> <span class="br0">&#91;</span><span class="st0">&quot;pub&quot;</span> <span class="sy0">=&gt;</span> <span class="re0">$newPub</span><span class="br0">&#93;</span><span class="br0">&#41;</span><span class="sy0">;</span>
    <span class="br0">&#125;</span>
<span class="br0">&#125;</span>
&nbsp;
<span class="re0">$foo</span> <span class="sy0">=</span> <span class="kw2">new</span> Foo<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
<span class="co1">// object(Foo)#2 (1) { [&quot;pub&quot;]=&gt; int(5) }</span>
<a href="http://www.php.net/var_dump"><span class="kw3">var_dump</span></a><span class="br0">&#40;</span><span class="re0">$foo</span><span class="sy0">-&gt;</span><span class="me1">withPub</span><span class="br0">&#40;</span><span class="nu0">5</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span></pre></div>

<p>
Public readonly properties need a <code class="code php"><span class="kw2">public</span><span class="br0">&#40;</span>set<span class="br0">&#41;</span></code> to be able to be cloned from outside the class, as the property is <code class="code php"><span class="kw2">protected</span><span class="br0">&#40;</span>set<span class="br0">&#41;</span></code> by default.
This is existing PHP behavior and unchanged by this <abbr title="Request for Comments">RFC</abbr>. Changing the visibility of <code class="code php">readonly</code> properties is outside the scope of this <abbr title="Request for Comments">RFC</abbr>, and this example is provided for sake of completeness and to thoroughly explain the existing edge cases.
</p>
<div class="phpok">
<pre class="code php"><span class="kw2">&lt;?php</span>
&nbsp;
<span class="kw2">class</span> Foo <span class="br0">&#123;</span>
    <span class="kw2">public</span> readonly int <span class="re0">$pub</span><span class="sy0">;</span>
<span class="br0">&#125;</span>
&nbsp;
<span class="re0">$foo</span> <span class="sy0">=</span> <span class="kw2">new</span> Foo<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
<a href="http://www.php.net/var_dump"><span class="kw3">var_dump</span></a><span class="br0">&#40;</span>clone<span class="br0">&#40;</span><span class="re0">$foo</span><span class="sy0">,</span> <span class="br0">&#91;</span><span class="st0">&quot;pub&quot;</span> <span class="sy0">=&gt;</span> <span class="nu0">5</span><span class="br0">&#93;</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span>
<span class="co1">// Fatal error: Uncaught Error: Cannot modify protected(set) readonly property Foo::$pub from global scope in ...</span></pre></div>

<p>
Protected and private properties can be changed from within their respective scopes.
</p>
<div class="phpok">
<pre class="code php"><span class="kw2">&lt;?php</span>
&nbsp;
<span class="kw2">class</span> Foo <span class="br0">&#123;</span>
    <span class="kw2">protected</span> readonly int <span class="re0">$prot</span><span class="sy0">;</span>
    <span class="kw2">private</span> readonly int <span class="re0">$priv</span><span class="sy0">;</span>
&nbsp;
    <span class="kw2">public</span> <span class="kw2">function</span> withPriv<span class="br0">&#40;</span>int <span class="re0">$priv</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
        <span class="kw1">return</span> clone<span class="br0">&#40;</span><span class="re0">$this</span><span class="sy0">,</span> <span class="br0">&#91;</span><span class="st0">&quot;priv&quot;</span> <span class="sy0">=&gt;</span> <span class="re0">$priv</span><span class="br0">&#93;</span><span class="br0">&#41;</span><span class="sy0">;</span>
    <span class="br0">&#125;</span>
<span class="br0">&#125;</span>
&nbsp;
<span class="kw2">class</span> Bar <span class="kw2">extends</span> Foo <span class="br0">&#123;</span>
    <span class="kw2">public</span> <span class="kw2">function</span> withProt<span class="br0">&#40;</span>int <span class="re0">$prot</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
        <span class="kw1">return</span> clone<span class="br0">&#40;</span><span class="re0">$this</span><span class="sy0">,</span> <span class="br0">&#91;</span><span class="st0">&quot;prot&quot;</span> <span class="sy0">=&gt;</span> <span class="re0">$prot</span><span class="br0">&#93;</span><span class="br0">&#41;</span><span class="sy0">;</span>
    <span class="br0">&#125;</span>
<span class="br0">&#125;</span>
&nbsp;
<span class="re0">$foo</span> <span class="sy0">=</span> <span class="kw2">new</span> Foo<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
<span class="co1">// object(Foo)#2 (1) { [&quot;prot&quot;:protected]=&gt; uninitialized(int) [&quot;priv&quot;:&quot;Foo&quot;:private]=&gt; int(10) }</span>
<a href="http://www.php.net/var_dump"><span class="kw3">var_dump</span></a><span class="br0">&#40;</span><span class="re0">$foo</span><span class="sy0">-&gt;</span><span class="me1">withPriv</span><span class="br0">&#40;</span><span class="nu0">10</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
<span class="re0">$bar</span> <span class="sy0">=</span> <span class="kw2">new</span> Bar<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
<span class="co1">// object(Bar)#3 (1) { [&quot;prot&quot;:protected]=&gt; int(5) [&quot;priv&quot;:&quot;Foo&quot;:private]=&gt; uninitialized(int) }</span>
<a href="http://www.php.net/var_dump"><span class="kw3">var_dump</span></a><span class="br0">&#40;</span><span class="re0">$bar</span><span class="sy0">-&gt;</span><span class="me1">withProt</span><span class="br0">&#40;</span><span class="nu0">5</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
<span class="co1">// Fatal error: Uncaught Error: Cannot access protected property Bar::$prot in</span>
clone<span class="br0">&#40;</span><span class="re0">$bar</span><span class="sy0">,</span> <span class="br0">&#91;</span><span class="st0">&quot;prot&quot;</span> <span class="sy0">=&gt;</span> <span class="nu0">5</span><span class="br0">&#93;</span><span class="br0">&#41;</span><span class="sy0">;</span></pre></div>

</div>

<h4 id="assignment_order_and_property_hooks">Assignment order and property hooks</h4>
<div class="level4">

<p>
Property hooks are executed just as they would be with normal setters.
</p>
<div class="phpok">
<pre class="code php"><span class="kw2">&lt;?php</span>
&nbsp;
<span class="kw2">class</span> Foo <span class="br0">&#123;</span>
    <span class="kw2">public</span> string <span class="re0">$hooked</span> <span class="sy0">=</span> <span class="st_h">'default'</span> <span class="br0">&#123;</span>
        set <span class="br0">&#40;</span>string <span class="re0">$value</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
            <span class="re0">$this</span><span class="sy0">-&gt;</span><span class="me1">hooked</span> <span class="sy0">=</span> <a href="http://www.php.net/strtoupper"><span class="kw3">strtoupper</span></a><span class="br0">&#40;</span><span class="re0">$value</span><span class="br0">&#41;</span><span class="sy0">;</span>
        <span class="br0">&#125;</span>
    <span class="br0">&#125;</span>
<span class="br0">&#125;</span>
&nbsp;
<span class="re0">$x</span> <span class="sy0">=</span> <span class="kw2">new</span> Foo<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
<span class="co1">// object(Foo)#1 (1) { [&quot;hooked&quot;] =&gt; string(7) &quot;default&quot; }</span>
<a href="http://www.php.net/var_dump"><span class="kw3">var_dump</span></a><span class="br0">&#40;</span><span class="re0">$x</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
<span class="co1">// object(Foo)#2 (1) { [&quot;hooked&quot;] =&gt; string(7) &quot;UPDATED&quot; }</span>
<a href="http://www.php.net/var_dump"><span class="kw3">var_dump</span></a><span class="br0">&#40;</span>clone<span class="br0">&#40;</span><span class="re0">$x</span><span class="sy0">,</span> <span class="br0">&#91;</span><span class="st0">&quot;hooked&quot;</span> <span class="sy0">=&gt;</span> <span class="st_h">'updated'</span><span class="br0">&#93;</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span></pre></div>

</div>

<h4 id="throw_order">Throw order</h4>
<div class="level4">

<p>
Properties are set in the order they are passed in. The first error/exception raised cancels the rest of the clone operation.
</p>
<div class="phpok">
<pre class="code php"><span class="kw2">&lt;?php</span>
&nbsp;
<span class="kw2">class</span> Foo <span class="br0">&#123;</span>
&nbsp;
    <span class="kw2">public</span> <span class="kw2">function</span> __construct<span class="br0">&#40;</span>
        <span class="kw2">private</span> int <span class="re0">$a</span><span class="sy0">,</span>
        <span class="kw2">private</span> int <span class="re0">$b</span><span class="sy0">,</span>
        <span class="kw2">private</span> int <span class="re0">$c</span><span class="sy0">,</span>
    <span class="br0">&#41;</span> <span class="br0">&#123;</span><span class="br0">&#125;</span>
&nbsp;
    <span class="kw2">public</span> <span class="kw2">function</span> withInvalidValues<span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
        <span class="kw1">return</span> clone<span class="br0">&#40;</span><span class="re0">$this</span><span class="sy0">,</span> <span class="br0">&#91;</span>
            <span class="st0">&quot;a&quot;</span> <span class="sy0">=&gt;</span> <span class="nu0">5</span><span class="sy0">,</span>
            <span class="st0">&quot;b&quot;</span> <span class="sy0">=&gt;</span> <span class="st_h">'invalid argument'</span><span class="sy0">,</span>
            <span class="st0">&quot;c&quot;</span> <span class="sy0">=&gt;</span> <span class="st_h">'also invalid'</span>
        <span class="br0">&#93;</span><span class="br0">&#41;</span><span class="sy0">;</span>
    <span class="br0">&#125;</span>
<span class="br0">&#125;</span>
&nbsp;
<span class="re0">$foo</span> <span class="sy0">=</span> <span class="kw2">new</span> Foo<span class="br0">&#40;</span><span class="nu0">1</span><span class="sy0">,</span><span class="nu0">2</span><span class="sy0">,</span><span class="nu0">3</span><span class="br0">&#41;</span><span class="sy0">;</span>
<span class="re0">$foo</span><span class="sy0">-&gt;</span><span class="me1">withInvalidValues</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
<span class="co1">// Fatal error: Uncaught TypeError: Cannot assign string to property Foo::$b of type int in ...</span></pre></div>

<p>
Combined with property hooks:
</p>
<div class="phpok">
<pre class="code php"><span class="kw2">&lt;?php</span>
&nbsp;
<span class="kw2">class</span> Foo <span class="br0">&#123;</span>
&nbsp;
    <span class="kw2">public</span> <span class="kw2">function</span> __construct<span class="br0">&#40;</span>
        <span class="kw2">private</span> int <span class="re0">$a</span> <span class="br0">&#123;</span>
            set <span class="br0">&#40;</span>int <span class="re0">$value</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
                <span class="kw1">echo</span> <span class="st0">&quot;Got <span class="es4">$value</span>&quot;</span><span class="sy0">,</span> PHP_EOL<span class="sy0">;</span>
            <span class="br0">&#125;</span>
        <span class="br0">&#125;</span><span class="sy0">,</span>
        <span class="kw2">private</span> int <span class="re0">$b</span> <span class="br0">&#123;</span>
            set <span class="br0">&#40;</span>int <span class="re0">$value</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>	
                <span class="kw1">if</span> <span class="br0">&#40;</span><span class="re0">$value</span> <span class="sy0">&gt;</span> <span class="nu0">3</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
                    <span class="kw1">throw</span> <span class="kw2">new</span> InvalidArgumentException<span class="br0">&#40;</span><span class="st0">&quot;Rejecting <span class="es4">$value</span>&quot;</span><span class="br0">&#41;</span><span class="sy0">;</span>
                <span class="br0">&#125;</span>
            <span class="br0">&#125;</span>
        <span class="br0">&#125;</span><span class="sy0">,</span>
        <span class="kw2">private</span> int <span class="re0">$c</span> <span class="br0">&#123;</span>
            set <span class="br0">&#40;</span>int <span class="re0">$value</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
                <span class="kw1">echo</span> <span class="st0">&quot;Got <span class="es4">$value</span>&quot;</span><span class="sy0">,</span> PHP_EOL<span class="sy0">;</span>
            <span class="br0">&#125;</span>
        <span class="br0">&#125;</span><span class="sy0">,</span>
    <span class="br0">&#41;</span> <span class="br0">&#123;</span><span class="br0">&#125;</span>
&nbsp;
    <span class="kw2">public</span> <span class="kw2">function</span> withInvalidValues<span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
        <span class="kw1">return</span> clone<span class="br0">&#40;</span><span class="re0">$this</span><span class="sy0">,</span> <span class="br0">&#91;</span>
            <span class="st0">&quot;a&quot;</span> <span class="sy0">=&gt;</span> <span class="nu0">5</span><span class="sy0">,</span>
            <span class="st0">&quot;b&quot;</span> <span class="sy0">=&gt;</span> <span class="nu0">6</span><span class="sy0">,</span>
            <span class="st0">&quot;c&quot;</span> <span class="sy0">=&gt;</span> <span class="nu0">7</span><span class="sy0">,</span>
        <span class="br0">&#93;</span><span class="br0">&#41;</span><span class="sy0">;</span>
    <span class="br0">&#125;</span>
<span class="br0">&#125;</span>
&nbsp;
<span class="re0">$foo</span> <span class="sy0">=</span> <span class="kw2">new</span> Foo<span class="br0">&#40;</span><span class="nu0">1</span><span class="sy0">,</span><span class="nu0">2</span><span class="sy0">,</span><span class="nu0">3</span><span class="br0">&#41;</span><span class="sy0">;</span>
<span class="re0">$foo</span><span class="sy0">-&gt;</span><span class="me1">withInvalidValues</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
<span class="co1">// Got 1</span>
<span class="co1">// Got 2</span>
<span class="co1">// Got 3</span>
<span class="co1">// Got 5</span>
&nbsp;
<span class="co1">// Fatal error: Uncaught InvalidArgumentException: Rejecting 6 in ...</span></pre></div>

</div>

<h4 id="readonly">Readonly</h4>
<div class="level4">
<div class="phpok">
<pre class="code php"><span class="kw2">&lt;?php</span>
&nbsp;
<span class="kw2">class</span> Foo <span class="br0">&#123;</span>
    <span class="kw2">public</span> <span class="kw2">function</span> __construct<span class="br0">&#40;</span>
        <span class="kw2">public</span><span class="br0">&#40;</span>set<span class="br0">&#41;</span> readonly int <span class="re0">$c</span><span class="sy0">,</span>
    <span class="br0">&#41;</span> <span class="br0">&#123;</span><span class="br0">&#125;</span>
<span class="br0">&#125;</span>
&nbsp;
<span class="re0">$x</span> <span class="sy0">=</span> <span class="kw2">new</span> Foo<span class="br0">&#40;</span><span class="nu0">1</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
<a href="http://www.php.net/var_dump"><span class="kw3">var_dump</span></a><span class="br0">&#40;</span><span class="re0">$x</span><span class="br0">&#41;</span><span class="sy0">;</span> <span class="co1">// object(Foo)#1 (1) { [&quot;c&quot;]=&gt; int(1) }</span>
<a href="http://www.php.net/var_dump"><span class="kw3">var_dump</span></a><span class="br0">&#40;</span>clone<span class="br0">&#40;</span><span class="re0">$x</span><span class="sy0">,</span> <span class="br0">&#91;</span><span class="st0">&quot;c&quot;</span> <span class="sy0">=&gt;</span> <span class="nu0">2</span><span class="br0">&#93;</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span> <span class="co1">// object(Foo)#2 (1) { [&quot;c&quot;]=&gt; int(2) }</span>
&nbsp;
<span class="co1">// Without the (set) modifier on public, we'd get:</span>
<span class="co1">// Fatal error: Uncaught Error: Cannot modify protected(set) readonly property Foo::$c from global scope in example.php:12</span>
<span class="co1">// Note that this is how readonly properties work in PHP currently and any change would be outside the scope of this RFC</span></pre></div>

</div>

<h4 id="dynamic_properties">Dynamic Properties</h4>
<div class="level4">

<p>
Since property assignments are made just as a regular assignment would be, dynamic property creation follows established PHP rules:
</p>
<div class="phpok">
<pre class="code php"><span class="kw2">&lt;?php</span>
&nbsp;
<span class="kw2">class</span> Foo <span class="br0">&#123;</span>
<span class="br0">&#125;</span>
&nbsp;
&nbsp;
<span class="re0">$x</span> <span class="sy0">=</span> <span class="kw2">new</span> Foo<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
<span class="co1">// Deprecated: Creation of dynamic property Foo::$propertyThatDoesNotExist is deprecated in ...</span>
<span class="co1">// object(Foo)#2 (1) { [&quot;propertyThatDoesNotExist&quot;]=&gt; int(2) }</span>
<a href="http://www.php.net/var_dump"><span class="kw3">var_dump</span></a><span class="br0">&#40;</span>clone<span class="br0">&#40;</span><span class="re0">$x</span><span class="sy0">,</span> <span class="br0">&#91;</span><span class="st0">&quot;propertyThatDoesNotExist&quot;</span> <span class="sy0">=&gt;</span> <span class="nu0">2</span><span class="br0">&#93;</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
<span class="co2">#[AllowDynamicProperties]
</span><span class="kw2">class</span> Bar <span class="br0">&#123;</span>
<span class="br0">&#125;</span>
&nbsp;
<span class="re0">$y</span> <span class="sy0">=</span> <span class="kw2">new</span> Bar<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
<span class="co1">// object(Bar)#3 (1) { [&quot;propertyThatDoesNotExist&quot;]=&gt; int(2) }</span>
<a href="http://www.php.net/var_dump"><span class="kw3">var_dump</span></a><span class="br0">&#40;</span>clone<span class="br0">&#40;</span><span class="re0">$y</span><span class="sy0">,</span> <span class="br0">&#91;</span><span class="st0">&quot;propertyThatDoesNotExist&quot;</span> <span class="sy0">=&gt;</span> <span class="nu0">2</span><span class="br0">&#93;</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span></pre></div>

</div>

<h4 id="numeric_arrays">Numeric Arrays</h4>
<div class="level4">

<p>
Given the function signature <code class="code php">clone<span class="br0">&#40;</span>object <span class="re0">$object</span><span class="sy0">,</span> <a href="http://www.php.net/array"><span class="kw3">array</span></a> <span class="re0">$withProperties</span><span class="br0">&#41;</span><span class="sy0">:</span> object <span class="br0">&#123;</span><span class="br0">&#125;</span></code> it follows that numeric parameters derive their key from their implicit position as they would for any other PHP array. For <code class="code php">clone</code> this is usually not useful and is documented here for completeness.
</p>
<div class="phpok">
<pre class="code php"><span class="kw2">&lt;?php</span>
&nbsp;
<a href="http://www.php.net/var_dump"><span class="kw3">var_dump</span></a><span class="br0">&#40;</span>
    clone<span class="br0">&#40;</span><span class="kw2">new</span> stdClass<span class="sy0">,</span> <span class="br0">&#91;</span><span class="nu0">1</span><span class="sy0">,</span> <span class="nu0">2</span><span class="br0">&#93;</span><span class="br0">&#41;</span>
<span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
<span class="co1">// object(stdClass)#2 (2) {</span>
<span class="co1">//   [&quot;0&quot;]=&gt;</span>
<span class="co1">//   int(1)</span>
<span class="co1">//   [&quot;1&quot;]=&gt;</span>
<span class="co1">//   int(2)</span>
<span class="co1">// }</span></pre></div>

<p>
Omitting the array keys for most objects will lead to deprecation notices, as shown in the “Dynamic Properties” section.
</p>

</div>

<h2 class="sectionedit8" id="backward_incompatible_changes">Backward Incompatible Changes</h2>
<div class="level2">

<p>
No BC break is expected. The new syntax is optional and the old syntax will continue to work as before.
</p>

<p>
By not touching how <code class="code php">__clone<span class="br0">&#40;</span><span class="br0">&#41;</span></code> works, we also avoid any BC impact for users of this function.
</p>

</div>

<h2 class="sectionedit9" id="proposed_php_version_s">Proposed PHP Version(s)</h2>
<div class="level2">

<p>
Next PHP 8.x (8.5)
</p>

</div>

<h2 class="sectionedit10" id="rfc_impact">RFC Impact</h2>
<div class="level2">

</div>

<h3 class="sectionedit11" id="to_sapis">To SAPIs</h3>
<div class="level3">

<p>
None
</p>

</div>

<h3 class="sectionedit12" id="to_existing_extensions">To Existing Extensions</h3>
<div class="level3">

<p>
The current implementation adds a new <code>clone_obj_with</code> object handler that needs to be implemented to make internal classes compatible with clone with when custom cloning behavior is already implemented with <code>clone_obj</code>. If the default <code>clone_obj</code> handler is used, clone with will transparently work.
</p>

<p>
The existing behavior of <code>clone_obj</code> when no properties are given remains fully compatible. Thus, the only impact is that extensions that are not updated will be incompatible with clone with, but cloning behavior without properties remains compatible for existing PHP programs.
</p>

</div>

<h3 class="sectionedit13" id="to_opcache">To Opcache</h3>
<div class="level3">

<p>
None
</p>

</div>

<h3 class="sectionedit14" id="new_constants">New Constants</h3>
<div class="level3">

<p>
None
</p>

</div>

<h3 class="sectionedit15" id="phpini_defaults">php.ini Defaults</h3>
<div class="level3">

<p>
None
</p>

</div>

<h2 class="sectionedit16" id="open_issues">Open Issues</h2>
<div class="level2">

<p>
None
</p>

</div>

<h2 class="sectionedit17" id="unaffected_php_functionality">Unaffected PHP Functionality</h2>
<div class="level2">

</div>

<h2 class="sectionedit18" id="future_scope">Future Scope</h2>
<div class="level2">
<ul>
<li class="level1"><div class="li"> Allow <code class="code php">__clone<span class="br0">&#40;</span><span class="br0">&#41;</span></code> to inspect the <code class="code php"><span class="re0">$withProperties</span></code> array to skip deep-cloning properties that will be overridden.</div>
</li>
</ul>

</div>

<h2 class="sectionedit19" id="proposed_voting_choices">Proposed Voting Choices</h2>
<div class="level2">

<!-- Doodle Plugin -->
<form action="/start" method="post" name="doodle__form" id="doodle__form__implement_clone-with_as_outlined_in_the_rfc" accept-charset="utf-8" >

<input type="hidden" name="sectok" value="" />
<input type="hidden" name="do" value="show" >
<input type="hidden" name="id" value="rfc:clone_with_v2" >
<input type="hidden" name="formId" value="doodle__form__implement_clone-with_as_outlined_in_the_rfc" >
<input type="hidden" name="edit__entry"   value="">
<input type="hidden" name="delete__entry" value="">

<table class="inline">
  <tbody>
    <tr class="row0">
      <th class="centeralign" colspan="3">
        Implement clone-with as outlined in the RFC?      </th>
    </tr>
    <tr class="row1">
        <th class="col0">Real name</th>
        <td class="centeralign">Yes</td>
        <td class="centeralign">No</td>
    </tr>

    <tr>
        <td class="rightalign">
                    <a href="//people.php.net/alec">alec</a>&nbsp;(alec)        </td>
        <td  class="centeralign" style="background-color:#FCC">&nbsp;</td><td  class="centeralign" style="background-color:#AFA"><img src="/lib/images/success.png" title="2025/06/04 18:09"></td>        
    </tr>
    <tr>
        <td class="rightalign">
                    <a href="//people.php.net/asgrim">asgrim</a>&nbsp;(asgrim)        </td>
        <td  class="centeralign" style="background-color:#AFA"><img src="/lib/images/success.png" title="2025/06/04 15:14"></td><td  class="centeralign" style="background-color:#FCC">&nbsp;</td>        
    </tr>
    <tr>
        <td class="rightalign">
                    <a href="//people.php.net/beberlei">beberlei</a>&nbsp;(beberlei)        </td>
        <td  class="centeralign" style="background-color:#AFA"><img src="/lib/images/success.png" title="2025/06/04 15:38"></td><td  class="centeralign" style="background-color:#FCC">&nbsp;</td>        
    </tr>
    <tr>
        <td class="rightalign">
                    <a href="//people.php.net/crell">crell</a>&nbsp;(crell)        </td>
        <td  class="centeralign" style="background-color:#FCC">&nbsp;</td><td  class="centeralign" style="background-color:#AFA"><img src="/lib/images/success.png" title="2025/06/04 16:37"></td>        
    </tr>
    <tr>
        <td class="rightalign">
                    <a href="//people.php.net/derick">derick</a>&nbsp;(derick)        </td>
        <td  class="centeralign" style="background-color:#AFA"><img src="/lib/images/success.png" title="2025/06/09 10:50"></td><td  class="centeralign" style="background-color:#FCC">&nbsp;</td>        
    </tr>
    <tr>
        <td class="rightalign">
                    <a href="//people.php.net/edorian">edorian</a>&nbsp;(edorian)        </td>
        <td  class="centeralign" style="background-color:#AFA"><img src="/lib/images/success.png" title="2025/06/04 15:13"></td><td  class="centeralign" style="background-color:#FCC">&nbsp;</td>        
    </tr>
    <tr>
        <td class="rightalign">
                    <a href="//people.php.net/galvao">galvao</a>&nbsp;(galvao)        </td>
        <td  class="centeralign" style="background-color:#AFA"><img src="/lib/images/success.png" title="2025/06/09 09:27"></td><td  class="centeralign" style="background-color:#FCC">&nbsp;</td>        
    </tr>
    <tr>
        <td class="rightalign">
                    <a href="//people.php.net/kalle">kalle</a>&nbsp;(kalle)        </td>
        <td  class="centeralign" style="background-color:#FCC">&nbsp;</td><td  class="centeralign" style="background-color:#AFA"><img src="/lib/images/success.png" title="2025/06/04 20:06"></td>        
    </tr>
    <tr>
        <td class="rightalign">
                    <a href="//people.php.net/kguest">kguest</a>&nbsp;(kguest)        </td>
        <td  class="centeralign" style="background-color:#AFA"><img src="/lib/images/success.png" title="2025/06/13 09:05"></td><td  class="centeralign" style="background-color:#FCC">&nbsp;</td>        
    </tr>
    <tr>
        <td class="rightalign">
                    <a href="//people.php.net/kocsismate">kocsismate</a>&nbsp;(kocsismate)        </td>
        <td  class="centeralign" style="background-color:#AFA"><img src="/lib/images/success.png" title="2025/06/13 22:07"></td><td  class="centeralign" style="background-color:#FCC">&nbsp;</td>        
    </tr>
    <tr>
        <td class="rightalign">
                    <a href="//people.php.net/ocramius">ocramius</a>&nbsp;(ocramius)        </td>
        <td  class="centeralign" style="background-color:#AFA"><img src="/lib/images/success.png" title="2025/06/04 20:10"></td><td  class="centeralign" style="background-color:#FCC">&nbsp;</td>        
    </tr>
    <tr>
        <td class="rightalign">
                    <a href="//people.php.net/ramsey">ramsey</a>&nbsp;(ramsey)        </td>
        <td  class="centeralign" style="background-color:#FCC">&nbsp;</td><td  class="centeralign" style="background-color:#AFA"><img src="/lib/images/success.png" title="2025/06/09 03:08"></td>        
    </tr>
    <tr>
        <td class="rightalign">
                    <a href="//people.php.net/seld">seld</a>&nbsp;(seld)        </td>
        <td  class="centeralign" style="background-color:#AFA"><img src="/lib/images/success.png" title="2025/06/05 13:11"></td><td  class="centeralign" style="background-color:#FCC">&nbsp;</td>        
    </tr>
    <tr>
        <td class="rightalign">
                    <a href="//people.php.net/sergey">sergey</a>&nbsp;(sergey)        </td>
        <td  class="centeralign" style="background-color:#AFA"><img src="/lib/images/success.png" title="2025/06/05 10:53"></td><td  class="centeralign" style="background-color:#FCC">&nbsp;</td>        
    </tr>
    <tr>
        <td class="rightalign">
                    <a href="//people.php.net/thekid">thekid</a>&nbsp;(thekid)        </td>
        <td  class="centeralign" style="background-color:#AFA"><img src="/lib/images/success.png" title="2025/06/10 13:08"></td><td  class="centeralign" style="background-color:#FCC">&nbsp;</td>        
    </tr>
    <tr>
        <td class="rightalign">
                    <a href="//people.php.net/theodorejb">theodorejb</a>&nbsp;(theodorejb)        </td>
        <td  class="centeralign" style="background-color:#AFA"><img src="/lib/images/success.png" title="2025/06/04 15:15"></td><td  class="centeralign" style="background-color:#FCC">&nbsp;</td>        
    </tr>
    <tr>
        <td class="rightalign">
                    <a href="//people.php.net/timwolla">timwolla</a>&nbsp;(timwolla)        </td>
        <td  class="centeralign" style="background-color:#AFA"><img src="/lib/images/success.png" title="2025/06/04 15:09"></td><td  class="centeralign" style="background-color:#FCC">&nbsp;</td>        
    </tr>
    <tr>
        <td class="rightalign">
                    <a href="//people.php.net/weierophinney">weierophinney</a>&nbsp;(weierophinney)        </td>
        <td  class="centeralign" style="background-color:#AFA"><img src="/lib/images/success.png" title="2025/06/08 20:06"></td><td  class="centeralign" style="background-color:#FCC">&nbsp;</td>        
    </tr>
 
    <!-- Results / sum per column -->
    <tr>
        <th class="rightalign"><b>Count:</b></th>
        <th class="centeralign"><b>14</b></th>
        <th class="centeralign"><b>4</b></th>
    </tr>



  </tbody>
</table>

</form>





</div>

<h2 class="sectionedit20" id="patches_and_tests">Patches and Tests</h2>
<div class="level2">
<ul>
<li class="level1"><div class="li"> <a href="https://github.com/php/php-src/pull/18747" class="urlextern" title="https://github.com/php/php-src/pull/18747" rel="ugc nofollow">https://github.com/php/php-src/pull/18747</a></div>
</li>
</ul>

</div>

<h2 class="sectionedit21" id="implementation">Implementation</h2>
<div class="level2">

<p>
TBD
</p>

</div>

<h2 class="sectionedit22" id="references">References</h2>
<div class="level2">
<ul>
<li class="level1"><div class="li"> <a href="https://wiki.php.net/rfc/clone_with" class="urlextern" title="https://wiki.php.net/rfc/clone_with" rel="ugc nofollow">https://wiki.php.net/rfc/clone_with</a></div>
</li>
<li class="level1"><div class="li"> <a href="https://externals.io/message/120048" class="urlextern" title="https://externals.io/message/120048" rel="ugc nofollow">https://externals.io/message/120048</a></div>
</li>
</ul>

</div>

<h2 class="sectionedit23" id="rejected_features">Rejected Features</h2>
<div class="level2">

<p>
For the reasons mentioned in the introduction and the Backwards Incompatible Changes section, changes to the magic <code class="code php">__clone<span class="br0">&#40;</span><span class="br0">&#41;</span></code> method are out of scope for this <abbr title="Request for Comments">RFC</abbr>.
</p>

</div>

<h2 class="sectionedit24" id="changelog">Changelog</h2>
<div class="level2">

<p>
Earlier versions of this <abbr title="Request for Comments">RFC</abbr> proposed a <code class="code php">clone</code> method with named-parameters. This was dropped in favor of less complex functions with more familiar syntax and no newly invented concepts not seen anywhere else in php-src. The <abbr title="Request for Comments">RFC</abbr>, the implementation and the documentation efforts needed were significantly reduced by this change.
</p>

</div>
                    <!-- wikipage stop -->
                                    </div>

                <div class="docInfo"><bdi>rfc/clone_with_v2.txt</bdi> · Last modified: 2025/06/04 15:08 by <bdi>edorian</bdi></div>

                            </div></div><!-- /content -->

            <hr class="a11y" />

            <!-- PAGE ACTIONS -->
            <div id="dokuwiki__pagetools">
                <h3 class="a11y">Page Tools</h3>
                <div class="tools">
                    <ul>
                        <li><a href="/rfc/clone_with_v2?do=edit"  class="action source" accesskey="v" rel="nofollow" title="Show pagesource [V]"><span>Show pagesource</span></a></li><li><a href="/rfc/clone_with_v2?do=revisions"  class="action revs" accesskey="o" rel="nofollow" title="Old revisions [O]"><span>Old revisions</span></a></li><li><a href="/rfc/clone_with_v2?do=backlink"  class="action backlink" rel="nofollow" title="Backlinks"><span>Backlinks</span></a></li><li><a href="#dokuwiki__top"  class="action top" accesskey="t" rel="nofollow" title="Back to top [T]"><span>Back to top</span></a></li>                    </ul>
                </div>
            </div>
        </div><!-- /wrapper -->

    </div></div><!-- /site -->

    <div class="no"><img src="/lib/exe/taskrunner.php?id=rfc%3Aclone_with_v2&amp;1749905103" width="2" height="1" alt="" /></div>
    <div id="screen__mode" class="no"></div>    <!--[if ( lte IE 7 | IE 8 ) ]></div><![endif]-->
</section>

﻿<section class="secondscreen">
  <!-- TOC START -->
<div id="dw__toc" class="dw__toc">
<h3 class="toggle">Table of Contents</h3>
<div>

<ul class="toc">
<li class="level1"><div class="li"><a href="#php_rfcclone_with_v2">PHP RFC: Clone with v2</a></div>
<ul class="toc">
<li class="level2"><div class="li"><a href="#introduction">Introduction</a></div></li>
<li class="level2"><div class="li"><a href="#prior_works">Prior Works</a></div></li>
<li class="level2"><div class="li"><a href="#proposal">Proposal</a></div>
<ul class="toc">
<li class="level3"><div class="li"><a href="#technical_details">Technical Details</a></div></li>
<li class="level3"><div class="li"><a href="#design_goals">Design Goals</a></div></li>
<li class="level3"><div class="li"><a href="#examples">Examples</a></div></li>
</ul>
</li>
<li class="level2"><div class="li"><a href="#backward_incompatible_changes">Backward Incompatible Changes</a></div></li>
<li class="level2"><div class="li"><a href="#proposed_php_version_s">Proposed PHP Version(s)</a></div></li>
<li class="level2"><div class="li"><a href="#rfc_impact">RFC Impact</a></div>
<ul class="toc">
<li class="level3"><div class="li"><a href="#to_sapis">To SAPIs</a></div></li>
<li class="level3"><div class="li"><a href="#to_existing_extensions">To Existing Extensions</a></div></li>
<li class="level3"><div class="li"><a href="#to_opcache">To Opcache</a></div></li>
<li class="level3"><div class="li"><a href="#new_constants">New Constants</a></div></li>
<li class="level3"><div class="li"><a href="#phpini_defaults">php.ini Defaults</a></div></li>
</ul>
</li>
<li class="level2"><div class="li"><a href="#open_issues">Open Issues</a></div></li>
<li class="level2"><div class="li"><a href="#unaffected_php_functionality">Unaffected PHP Functionality</a></div></li>
<li class="level2"><div class="li"><a href="#future_scope">Future Scope</a></div></li>
<li class="level2"><div class="li"><a href="#proposed_voting_choices">Proposed Voting Choices</a></div></li>
<li class="level2"><div class="li"><a href="#patches_and_tests">Patches and Tests</a></div></li>
<li class="level2"><div class="li"><a href="#implementation">Implementation</a></div></li>
<li class="level2"><div class="li"><a href="#references">References</a></div></li>
<li class="level2"><div class="li"><a href="#rejected_features">Rejected Features</a></div></li>
<li class="level2"><div class="li"><a href="#changelog">Changelog</a></div></li>
</ul></li>
</ul>
</div>
</div>
<!-- TOC END -->
</section>
</section><!-- .fullscreen -->
<footer>
  <nav class="fullscreen">
    <ul>
      <li><a href="//php.net/copyright">Copyright © 2001-2025 The PHP Group</a></li>
      <li><a href="//php.net/sites">Other PHP.net sites</a></li>
      <li><a href="//php.net/privacy">Privacy policy</a></li>
    </ul>
  </nav>
</footer>

</div><!-- .wrap -->
</body>
</html>
